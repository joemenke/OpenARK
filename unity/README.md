## OpenARK Unity Plugin

### Overview

This Unity plugin fully abstracts the communications between OpenARK's native library and the Unity game engine, providing a simple object-oriented interface that
allows developers to easily access OpenARK functionality such as hand tracking, plane detection, and surface contact detection from any Unity project.

The Unity-facing interface currently contains provides three classes: OpenARK.Detector, OpenARK.Hand, and OpenARK.Plane.

#### Components

The plugin contains two files -- the first is a native C++ dynamic library (DLL) that provides a simple dynamic interface to OpenARK. The second is a managed C# DLL that 
provides a clean wrapper.

### Usage in Unity

To use OpenARK in any Unity (Free or Pro) project, simply copy the plugin's native AND C# DLLs to `UNITY_PROJECT_DIR/Assets/Plugins`, creating the `Plugins` directory if necessary.
You may obtain the DLLS from the OpenARK release. If you wish to build it yourself, the following section contains information on how to build the DLLs from scratch.

### Build Instructions

#### Building the Native DLL

1. Run CMake for the project as you normally would for building OpenARK. Also, make sure you have Unity (version at least 5) properly installed and working.

2. Build the native DLL (the UnityPlugin project) using the Visual Studio solution (or some other build system) generated by OpenARK's CMake

#### Building the Managed DLL

1. Create a new Visual C# project in Visual Studio or MonoDevelop, with output type `Class Library`. Delete any existing files.

2. *IMPORTANT* : Go to `Project > my_project Properties` and change the framework version to 3.5. This is needed for Unity support.

3. Add `unity/managed/OpenARK.cs` to the C# project by right clicking the project in the Solution Explorer and then selecting `Add > Existing Item`.

4. Add the native DLL built in step 1, `Release/openark_unity_x_x_x_native.dll`, to the C# project using the same method as in the previous step.

5. Add `YOUR_UNITY_INSTALL_PATH/Editor/Data/Managed/UnityEngine.dll` to the project's references by expanding the project in the Solution Explorer,
   right clicking `References`, then choosing `Add Reference`.
   
6. Select the `Release` configuration and build the C# project by going to `Build > Build my_project_name`. If you haven't changed the output path, the DLL will be in `PROJECT_DIR/bin/Release/`.
   The DLL name doesn't technically matter, though `openark_unity_x_x_x_managed.dll` is what our release uses.

### Sample Code

The following C# sample script (Controller.cs) uses OpenARK's hand detection functionality to allow users to control multiple Unity game objects using their fingers:

```cs
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

/** Controller.cs: Add this script to an empty game object and follow the instructions below. */
public class Controller : MonoBehaviour {
    public float scale = 100.0f; // the scaling factor between real world and Unity distances. You can leave this at 100.
    public GameObject palm; // create and drag a palm object to this field in the unity editor
    public GameObject[] fingers; // create and drag five finger objects to this field in the unity editor
    
    private OpenARK.Detector detector;

    void Start () {
        detector = new OpenARK.Detector(true);
    }

    void Update () {
        detector.update();
        List<OpenARK.Hand> hands = detector.getHands();
        if (hands.Count > 0)
        {
            OpenARK.Hand hand = hands[0];
            palm.transform.position = hand.center * scale;
            for (int i = 0; i < Mathf.Min(hand.fingers.Length, fingers.Length); ++i)
            {
                fingers[i].SetActive(true);
                fingers[i].transform.position = hand.fingers[i] * scale;
            }

            for (int i = hand.fingers.Length; i < fingers.Length; ++i)
            {
                fingers[i].SetActive(false);
            }
        }
    }
}
```

This script file is also available at `unity/samplecode/Controller.cs`.
